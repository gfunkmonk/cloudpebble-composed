web:
  build: cloudpebble/
  ports:
    - "80:80"
  volumes:
    - "./cloudpebble/:/code"
  links:
    - redis
    - postgres
    - s3
    - qemu
    - ycmd
  environment:
    - DEBUG="yes"
    - RUN_WEB="yes"
    - AWS_ENABLED="yes"
    - PORT=80
    - AWS_S3_FAKE_S3=10.142.0.2:8003
    - MEDIA_URL=http://10.142.0.2:8003/builds.cloudpebble.net/
    - QEMU_URLS=http://10.142.0.2:8001/
    - YCM_URLS=http://10.142.0.2:8002/
    - PUBLIC_URL=http://10.142.0.2/
    - LIBPEBBLE_PROXY=wss://10.142.0.2:8005/tool
    - PEBBLE_AUTH_URL=https://auth.rebble.io
celery:
  build: cloudpebble/
  volumes:
    - "./cloudpebble/:/code"
  links:
    - redis
    - postgres
    - s3
  environment:
    - DEBUG="yes"
    - RUN_CELERY="yes"
    - AWS_ENABLED=yes
    - EXPORT_ROOT=http://10.142.0.2:8003/export.cloudpebble.net/
    - AWS_S3_FAKE_S3=10.142.0.2:8003
qemu:
  build: cloudpebble-qemu-controller/
  volumes:
    - "./cloudpebble-qemu-controller/:/code"
  ports:
    - "8001:80"
  environment:
    - PEBBLE_TIMELINE_INTERNAL_API=https://timeline-sync.rebble.io
    - PEBBLE_TIMELINE_PUBLIC_API=https://timeline-api.rebble.io
ycmd:
  build: cloudpebble-ycmd-proxy/
  volumes:
    - "./cloudpebble-ycmd-proxy/:/code"
  ports:
    - "8002:80"
cloudpebble-ws-proxy:
   build: cloudpebble-ws-proxy-standalone/
   volumes:
     - "./cloudpebble-ws-proxy-standalone/:/code"
   environment:
     - PEBBLE_AUTH_URL=http://auth.rebble.io
     - PORT=8005
   ports:
     - "8005:80"
redis:
  image: redis
postgres:
  image: postgres
s3:
  image: lphoward/fake-s3
  ports:
    - "8003:4569"
